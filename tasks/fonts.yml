# vim:ft=ansible:
---
- name: Fonts | Install packages
  pacaur:
    name: "{{ item }}"
    state: present
  with_items:
    - cairo
    - fontconfig
    - fonts-meta-base
    - fonts-meta-extended-lt # this package is broken as of Feb 13, 2018
    - freetype2
    - gsfonts
    - libxft
    - noto-fonts
    - powerline-fonts-git
    - otf-font-awesome
    - siji-git
  become: true

- name: Fonts | Enable LCD filter
  file:
    src: /etc/fonts/conf.avail/11-lcdfilter-default.conf
    dest: /etc/fonts/conf.d/11-lcdfilter-default.conf
    state: link
  become: true

- name: Fonts | Enable sub-pixel rendering
  file:
    src: /etc/fonts/conf.avail/10-sub-pixel-rgb.conf
    dest: /etc/fonts/conf.d/10-sub-pixel-rgb.conf
    state: link
  become: true

- name: Fonts | Enable crisper fonts with hinting
  file:
    src: /etc/fonts/conf.avail/10-hinting-full.conf
    dest: /etc/fonts/conf.d/10-hinting-full.conf
    state: link
  become: true

- name: Fonts | Disable bitmap fonts
  file:
    src: /etc/fonts/conf.avail/70-no-bitmaps.conf
    dest: /etc/fonts/conf.d/70-no-bitmaps.conf
    state: link
  become: true

# Source of below - https://gist.github.com/cryzed/e002e7057435f02cc7894b9e748c5671
# This is broken as of Feb 13, 2018 since I can't install fonts-meta-extended-lt
- name: Fonts | Enable infinality-like fonts
  file:
    src: /etc/fonts/conf.avail/30-infinality-aliases.conf
    dest: /etc/fonts/conf.d/30-infinality-aliases.conf
    state: link
  become: true

- name: Fonts | Enable subpixel autohinting with freetype2
  become: true
  lineinfile:
    dest: "/etc/profile.d/freetype2.sh"
    regexp: ".*export FREETYPE_PROPERTIES=.*"
    line: 'export FREETYPE_PROPERTIES="truetype:interpreter-version=40"'

- name: Fonts | Set font family choices
  become: true
  copy:
    src: fonts-local.conf
    dest: /etc/fonts/local.conf

- name: Fonts | Fix console font setting
  become: true
  copy:
    src: systemd-vconsole-setup.service
    dest: /usr/lib/systemd/system/systemd-vconsole-setup.service

- name: Fonts | Configure console font
  become: true
  copy:
    src: vconsole.conf
    dest: /etc/vconsole.conf
